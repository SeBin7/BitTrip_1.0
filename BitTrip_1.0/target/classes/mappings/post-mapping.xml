<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BitPostDAO">

	<resultMap id="postInfo" type="post">
		<id property="post_id" column="post_id" />
		<result property="user_id" column="user_id" />
		<result property="name" column="name" />
		<result property="title" column="title" />
		<result property="trip_date" column="trip_date" />
		<result property="country" column="country" />
		<result property="month" column="month" />
		<result property="trip_thema" column="trip_thema" />
		<result property="create_date" column="create_date" />
		<result property="count" column="count" />
		<collection property="content" javaType="java.util.ArrayList"
			resultMap="contentList" />
		<collection property="location" javaType="java.util.ArrayList"
			resultMap="locationList" />
	</resultMap>

	<resultMap id="contentList" type="java.util.HashMap">
		<id property="post_id_day" column="post_id_day" />
		<result property="post_id" column="post_id" />
		<result property="content" column="content" />
	</resultMap>
	
	<resultMap id="locationList" type="java.util.HashMap">
		<id property="post_id_day" column="post_id_day" />
		<result property="location" column="location" />
		<result property="sort" column="sort" />
	</resultMap>

	<insert id="insertPost">
		<![CDATA[
			INSERT INTO BOARD(SEQ, TITLE, WRITER, CONTENT)
			VALUES((SELECT NVL(MAX(seq),0)+1 FROM BOARD),#{title},#{writer},#{content})
		]]>
	</insert>

	<update id="updatePost">
		<![CDATA[
			UPDATE BOARD SET TITLE=#{title}, CONTENT=#{content} WHERE SEQ=#{seq}
		]]>
	</update>

	<delete id="deletePost">
		<![CDATA[
			DELETE BOARD WHERE SEQ=#{seq}
		]]>
	</delete>

	<select id="getPost" resultType="post">
		<![CDATA[
			SELECT * FROM BOARD WHERE SEQ=#{seq}
		]]>
	</select>

	<select id="getPostList" resultType="post">
		SELECT * FROM BITPOSTS
	</select>

	<select id="getPostInfo" resultMap="postInfo">
		<![CDATA[			
			SELECT  a.post_id, a.name, a.title, b.content, c.location, c.sort
		    FROM    bitposts a 
		    LEFT JOIN bittripday b ON a.post_id = b.post_id
		    LEFT JOIN bitdaylocation c ON b.post_id_day = c.post_id_day 
		    WHERE   a.post_id = #{post_id}
		    
		]]>
	</select>
</mapper>